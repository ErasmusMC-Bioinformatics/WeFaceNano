{% extends 'base.html' %}
{% load staticfiles %}
{% block head %}

<script>
    function openResult(evt, rname) {
    // Declare all variables
    var i, tabcontent, tablinks;
    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(rname).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>

{% endblock %}

{% block content %}
<div class="header">
    <div class="container">
        <div id="menu">
            <ul id="menubar">
                <li><a href="{% url 'index' %}">HOME</a></li>
                {% if user %}
                    <li><a href="{% url 'pipeline' %}">PIPELINES</a></li>
                {% else %}
                    <li><a href="{% url 'pipeline' %}" class="disabled"><span style="text-decoration: line-through;">PIPELINES</span></a></li>
                {% endif %}
                <li><a href="{% url 'readme' %}">README</a></li>
                <div id="smenubar">
                    {% if user %}
                        <li>
                            <b><small style="color:rgb(136,162,175); font-size:9pt;">Logged in as: <span style="color:rgb(255,100,0);">{{ user }}</span></small></b>
                        </li>
                        <li><a href="{% url 'logout' %}">LOGOUT</a></li>
                        {% if super %}
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li><a href="{% url 'signup' %}">SIGN UP</a></li>
                        {% endif %}
                    {% else %}
                        <li><a href="{% url 'login' %}">LOGIN</a></li>
                    {% endif %}
                </div>
            </ul>
        </div>
    </div>
</div>
<div class="container" style="margin-top:100px">
    {% for res, tools in dict.items %}
        <h1>{{res}}</h1>
    {% endfor %}
    <div class="tab">
        {% for b in barcodes %}
            <button class="tablinks" onclick="openResult(event, '{{ b }}')">{{ b }}</button>
        {% endfor %}
    </div>
    {% for b in barcodes %}
        <div id="{{ b }}" class="tabcontent" style="display:none;">
            {% for res, tools in dict.items %}
                <h3>Assembly</h3>
                <table class="table">
                    <th><a>Contig</a></th>
                    <th><a>Length</a></th>
                {% for barcode, contiglength in assemblyreport.items %}
                    <tr>
                    {% if b in barcode %}
                        <td>{{barcode}}</td>
                        <td>{{contiglength}} bp</td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </table>
                <br>
                {% if resfinder %}
                    <h3>Resfinder</h3>
                    <table class="table">
                        <th><a>Contig</a></th>
                        <th><a>Gene(s)</a></th>
                    {% for contig, arg in resfinder.items %}
                        {% if b in contig %}
                        <tr>
                            <td>
                                {{contig}}
                            </td>
                            <td>
                                {% for g in arg %}
                                    {{g}}<br>
                                {% endfor %}
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                    </table>
                {% endif %}
            {% endfor %}
            {% if blastresults %}
                <h3>BLAST</h3>
                <table class="table">
                    <th><a>Contig</a></th>
                    <th><a>Name or Accession number</a></th>
                    <th><a>Percentage identity</a></th>
                    <th><a>alignment length</a></th>
                    {% for contig, results in blastresults.items %}
                        {% if b in contig %}
                        <tr>
                            <td>
                                {{contig}}
                            </td>
                        {% for r in results %}
                            <td>
                                {{r}}
                            </td>
                        {% endfor %}
                        </tr>
                        {%  endif %}
                    {% endfor %}
                </table>
            {% endif %}
            {% if plasmid %}
                <h3>Plasmids</h3>
                <table style="width:50%; text-align:center;">
                    {% for r, html in plasmid.items %}
                        {% if html %}
                            {% if b in r %}
                            <tr>
                                {% for h in html %}
                                    {% if h|length > 0 %}
                                    <td>
                                        <h2>{{r}}</h2>
                                        {% for acc, topo in topology.items %}
                                        {% if acc in h %}
                                            <!--<td>-->
                                                {% if topo == "circular" %}
                                                <figure>
                                                <img id="circular" src="{% static 'img/circular.png' %}" width="8%" height="8%">
                                                    <figcaption>
                                                        {{ topo }}
                                                    </figcaption>
                                                </figure>
                                                {% elif topo == "linear" %}
                                                <figure>
                                                    <img id="linear" src="{% static 'img/linear.jpg' %}" width="8%" height="8%">
                                                    <figcaption>
                                                        {{ topo }}
                                                    </figcaption>
                                                </figure>
                                                {% endif %}
                                            <!--</td>-->
                                        {% endif %}
                                    {% endfor %}
                                        <iframe srcdoc="{{ h }}" frameborder="0" scrolling="no" width="800" height="800"></iframe>
                                    {% else %}
                                        NO PLASMIDS
                                    {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                            {% endif %}
                        {% else %}
                            NO PLASMIDS
                        {% endif %}
                    {% endfor %}
                </table>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% endblock %}