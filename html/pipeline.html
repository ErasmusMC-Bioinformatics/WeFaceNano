{% extends 'base.html' %}
{% load staticfiles %}

{% block head %}
<script type="text/javascript">
function showLoading() {
    document.getElementById('loading').style.display = "block";
    document.getElementById('pipeline-form').style.display = "none";
    document.run.submit();
    return true
}
</script>

<script>
function openResult(evt, rname) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(rname).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>
{% endblock %}

{% block content %}
<div class="header">
    <div class="container">
        <div id="menu">
            <ul id="menubar">
                <li><a href="{% url 'index' %}">HOME</a></li>
                {% if user %}
                    <li><a href="{% url 'pipeline' %}">PIPELINES</a></li>
                {% else %}
                    <li><a href="{% url 'pipeline' %}" class="disabled"><span style="text-decoration: line-through;">PIPELINES</span></a></li>
                {% endif %}
                <li><a href="{% url 'delete' %}">DELETE</a></li>
                <li><a href="{% url 'readme' %}">README</a></li>
                <div id="smenubar">
                    {% if user %}
                        <li>
                            <b><small style="color:rgb(136,162,175); font-size:9pt;">Logged in as: <span style="color:rgb(255,100,0);">{{ user }}</span></small></b>
                        </li>
                        <li><a href="{% url 'logout' %}">LOGOUT</a></li>
                        {% if super %}
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li><li>&nbsp;</li>
                            <li><a href="{% url 'signup' %}">SIGN UP</a></li>
                        {% endif %}
                    {% else %}
                        <li><a href="{% url 'login' %}">LOGIN</a></li>
                    {% endif %}
                </div>
            </ul>
        </div>
    </div>
</div>
<div class="container" style="margin-top:100px">
    <div id="pipeline-form" style="display:block;">
        <div class="tab">
            <button class="tablinks" onclick="openResult(event, 'plasmids')">Plasmids</button>
        </div>
        <br>
        <div id="inputs">
            <form action="{% url 'createresults' %}" method="post" name="run" enctype="multipart/form-data">
                <span style="color:red">*</span> = required fields <br><br>
                <table class="table">
                    <tr>
                        <td>
                            <h3>Input</h3>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            Select input type. (default = FASTQ)
                        </td>
                        <td>
                            <input type="radio" name="inputtype" value='fastq' checked="checked">&nbsp;<label>FASTQ &nbsp;&nbsp;&nbsp;</label>
                            <input type="radio" name="inputtype" value='fast5'>&nbsp;<label>FAST5 &nbsp;&nbsp;&nbsp;</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Select folder with reads <span style="color:red">*</span>
                        </td>
                        <td>
                            <select id="inputfolder" name="inputfolder" class="ddmenu">
                                <optgroup label="folders">
                                {% for folder in folders %}
                                    <option value="{{ folder }}">{{ folder }}</option>
                                {% endfor %}
                                </optgroup>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>Output</h3>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            Output folder <span style="color:red">*</span>
                        </td>
                        <td>
                            <input type="text" name="albacoreout" id="albacoreout" placeholder="Enter output folder" required>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>Albacore Settings</h3>
                            <b><i>Albacore will only run when the FAST5 input type is selected.</i></b>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Barcoding [yes/no] (default = no)</td>
                        <td>
                            <input type="radio" name="barcoding" id="barcoding" value='1'>&nbsp;<label>yes &nbsp;&nbsp;&nbsp;</label>
                            <input type="radio" name="barcoding" id="barcoding" value='0' checked="checked">&nbsp;<label>no &nbsp;&nbsp;&nbsp;</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Select flowcell configuration (default = FLO-MIN106)
                        </td>
                        <td>
                            <select id="aconfig" name="aconfig" class="ddmenu">
                                <optgroup label="Albacore configurations">
                                    <option value="r94_450bps_linear.cfg">FLO-MIN106</option>
                                    <option value="r94_70bps_rna_linear.cfg">FLO-MIN106 RNA</option>
                                    <option value="r95_450bps_linear.cfg">FLO-MIN107</option>
                                    <option value="r95_70bps_rna_linear.cfg">FLO-MIN107 RNA</option>
                                    <option value="r941_450bps_linear_prom.cfg">FLO-PRO001</option>
                                </optgroup>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>Assembly Settings</h3>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Select assembler:</td>
                        <td>
                            <input type="radio" name="assembler" id="assembler" value='canu' checked="checked">&nbsp;<label>Canu &nbsp;&nbsp;&nbsp;</label>
                            <input type="radio" name="assembler" id="assembler" value='miniasm'>&nbsp;<label>Miniasm &nbsp;&nbsp;&nbsp;</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Enter the genome size <span style="color:red">*</span><br><br>
                            <b>*</b> The genome size should be your best guess of the haploid genome size of what is being
                            assembled.  It is used primarily to estimate coverage in reads, NOT as the desired
                            assembly size.  Fractional values are allowed: '4.7m' equals '4700k' equals '4700000'
                        </td>
                        <td>
                            <input type="text" name="gsize" id="gsize" placeholder="Enter genome size i.e. 4.7m or 4700k or 4700000" required>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>Circularize Contigs</h3>
                        </td>
                        <td>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            Check the checkbox to circularize contigs
                        </td>
                        <td><input type="checkbox" name="circularize" id="circularize" value='yes'></td>
                    </tr>
                    <tr>
                        <td>Assembler</td>
                        <td>
                            <input type="radio" name="c_assembler" id="c_assembler" value='spades' checked="checked">&nbsp;<label>SPAdes &nbsp;&nbsp;&nbsp;</label>
                            <input type="radio" name="c_assembler" id="c_assembler" value='canu'>&nbsp;<label>Canu &nbsp;&nbsp;&nbsp;</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Kmer size<br>
                            <b><i>Enter odd numbers i.e. 33</i></b><br>
                            <b><i>To use multiple kmer sizes and automatically select the best assembly,
                                enter the sizes seperated by a comma i.e. 33,55,77,99</i></b>
                        </td>
                        <td>
                            <input type="text" id="kmer" name="kmer" placeholder="33,55,77,99">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>Analysis Tools Selection</h3>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            Select type <b>[ Plasmids -- Strains -- Microbiome ]</b> to see the available tools.<span style="color:red">*</span>
                        </td>
                        <td>
                            <input type="hidden" required>
                            <div id="plasmids" class="tabcontent" style="display:block;">
                                <input type="checkbox" name="blast" id="blast" value='-b '>&nbsp;<label>BLAST &nbsp;&nbsp;&nbsp;</label>
                                <input type="checkbox" name="res" id="res" value='-r '>&nbsp;<label>resFinder &nbsp;&nbsp;&nbsp;</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>BLAST Settings</h3>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            Select a BLAST database:
                        </td>
                        <td>
                            <select id="blastdb" name="blastdb" class="ddmenu">
                                <optgroup label="Remote BLAST Databases">
                                    <option value="nt -remote">Remote NT Database</option>
                                    <option value="nr -remote">Remote NR Database</option>
                                </optgroup>
                                <optgroup label="Local BLAST Databases">
                                    <option value="{{drive}}blastdb/nt">Local NT Database</option>
                                    <option value="{{drive}}blastdb/nr">Local NR Database</option>
                                    <option value="{{drive}}plasmidb/plasmidb">Local Plasmid Database</option>
                                    <option value="{{drive}}blastdb/toxoplasma">Local Toxoplasma Database</option>
                                </optgroup>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Select BLAST task</td>
                        <td>
                            <input type="radio" name="blasttask" id="blasttask" value='megablast' checked="checked">&nbsp;<label>megablast &nbsp;&nbsp;&nbsp;</label>
                            <input type="radio" name="blasttask" id="blasttask" value='blastn'>&nbsp;<label>blastn &nbsp;&nbsp;&nbsp;</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>ResFinder Settings</h3>
                        </td>
                    </tr>
                    <tr>
                        <td>Select a database to search for specific resistance genes or select all databases</td>
                        <td>
                            <select id="resdb" name="resdb" class="ddmenu">
                                <optgroup label="Select ResFinder Database">
                                    <option value="all">all databases</option>
                                    {% for db in resdb %}
                                        <option value="{{ db }}">{{ db }}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>The threshold for % identity</td>
                        <td>
                            <select id="residentity" name="residentity" class="ddmenu">
                                <optgroup label="Identity threshold">
                                    <option value="80.00">80%</option>
                                    <option value="85.00">85%</option>
                                    <option value="90.00">90%</option>
                                    <option value="95.00">95%</option>
                                    <option value="100.00">100%</option>
                                </optgroup>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>The minimum length of the overlap ex 0.60 for an overlap of minimum 60 %</td>
                        <td>
                             <select id="reslength" name="reslength" class="ddmenu">
                                 <optgroup label="Minimum length">
                                     <option value="0.60">60%</option>
                                     <option value="0.70">70%</option>
                                     <option value="0.80">80%</option>
                                     <option value="0.90">90%</option>
                                     <option value="1.00">100%</option>
                                 </optgroup>
                            </select>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <br />
        <div class="tab">
            <button class="runbutton" onclick="return showLoading()">RUN</button>
        </div>
    </div>
    <br>
    <div id="loading" style="display:none;">
        <h3>Running...</h3>
    </div>
</div>
{% endblock %}
